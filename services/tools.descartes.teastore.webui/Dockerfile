FROM descartesresearch/teastore-base:new
MAINTAINER Chair of Software Engineering <se2-it@informatik.uni-wuerzburg.de>

RUN   echo "tomcat.util.scan.StandardJarScanFilter.jarsToSkip=slf4j-api-1.7.25.jar,commons-lang-2.6.jar,servlet-api-2.5.jar,httpclient-4.5.3.jar,commons-logging-1.2.jar,log4j-1.2.15.jar,commons-codec-1.9.jar,slf4j-simple-1.7.25.jar,jackson-jaxrs-json-provider-2.8.4.jar,jersey-container-servlet-core-2.25.1.jar,javax.annotation-api-1.2.jar,jsp-api-2.1.jar,jersey-media-json-jackson-2.25.1.jar,jackson-databind-2.8.9.jar,rxjava-1.3.4.jar,jaeger-client-0.32.0.jar,hk2-utils-2.5.0-b32.jar,grizzly-http-2.3.28.jar,hk2-api-2.5.0-b32.jar,jersey-guava-2.25.1.jar,registryclient-1.3.8.jar,opentracing-api-0.31.0.jar,grizzly-websockets-2.3.28.jar,jersey-server-2.25.1.jar,opentracing-util-0.31.0.jar,netflix-statistics-0.1.1.jar,jstl-api-1.2.jar,jersey-entity-filtering-2.25.1.jar,jersey-common-2.25.1.jar,sigar-1.6.4.jar,validation-api-1.1.0.Final.jar,ribbon-loadbalancer-2.2.4.jar,jersey-media-jaxb-2.25.1.jar,jackson-annotations-2.8.9.jar,jackson-core-2.8.9.jar,ribbon-core-2.2.4.jar,connection-pool-2.3.28.jar,hk2-locator-2.5.0-b32.jar,gson-2.8.2.jar,httpcore-4.4.6.jar,jackson-jaxrs-base-2.8.4.jar,opentracing-noop-0.31.0.jar,entities-1.3.8.jar,libthrift-0.11.0.jar,javassist-3.20.0-GA.jar,annotations-2.0.0.jar,jsr305-3.0.1.jar,netflix-commons-util-0.1.1.jar,jaeger-tracerresolver-0.32.0.jar,commons-configuration-1.8.jar,jersey-container-servlet-2.25.1.jar,grizzly-framework-2.3.28.jar,jackson-module-jaxb-annotations-2.8.4.jar,opentracing-tracerresolver-0.1.5.jar,javax.inject-2.5.0-b32.jar,servo-core-0.10.1.jar,okio-1.13.0.jar,servo-internal-0.10.1.jar,grizzly-http-client-1.11.jar,archaius-core-0.7.4.jar,guava-20.0.jar,aopalliance-repackaged-2.5.0-b32.jar,jaeger-core-0.32.0.jar,javax.ws.rs-api-2.0.1.jar,jaeger-thrift-0.32.0.jar,okhttp-3.9.0.jar,jersey-grizzly-connector-2.25.1.jar,osgi-resource-locator-1.0.1.jar,jersey-client-2.25.1.jar" >> /usr/local/tomcat/conf/catalina.properties

COPY target/*.war /usr/local/tomcat/webapps/

CMD java -jar /usr/local/tomcat/bin/dockermemoryconfigurator.jar ${TOMCAT_HEAP_MEM_PERCENTAGE}; /usr/local/tomcat/bin/start.sh && echo '<% response.sendRedirect("/tools.descartes.teastore.webui/"); %>' > /usr/local/tomcat/webapps/ROOT/index.jsp && /usr/local/tomcat/bin/catalina.sh run
